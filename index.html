<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --blue: #0a84ff;
            --text: #ffffff;
            --grey: #8e8e93;
            --red: #ff3b30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            -webkit-user-select: none;
        }

        .header {
            margin-bottom: 24px;
            animation: fadeIn 0.5s ease-out;
        }

        .header h1 { font-size: 32px; font-weight: 700; margin: 0; }
        .header p { color: var(--grey); font-size: 15px; margin: 5px 0 0; text-transform: capitalize; }

        .task-list { display: flex; flex-direction: column; gap: 12px; }

        .task-card {
            background: var(--card);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.4s ease-out forwards;
            border-left: 4px solid var(--blue);
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { 
            from { opacity: 0; transform: translateX(-10px); } 
            to { opacity: 1; transform: translateX(0); } 
        }

        .category-icon {
            font-size: 24px;
            margin-right: 15px;
            background: #2c2c2e;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .task-info { flex-grow: 1; }
        .task-info h3 { margin: 0; font-size: 17px; font-weight: 600; }
        .task-info span { color: var(--grey); font-size: 13px; margin-top: 4px; display: block; }

        .check-btn {
            width: 28px;
            height: 28px;
            border: 2px solid #3a3a3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: transparent;
        }

        .check-btn.active {
            background-color: var(--blue);
            border-color: var(--blue);
            color: white;
            transform: scale(1.1);
        }

        #empty {
            text-align: center;
            margin-top: 100px;
            color: var(--grey);
        }

        .empty-icon { font-size: 50px; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

    <div class="header">
        <h1 id="user-name">–ú–æ–π –ø–ª–∞–Ω</h1>
        <p id="current-date"></p>
    </div>

    <div id="task-list" class="task-list"></div>

    <div id="empty" style="display: none;">
        <span class="empty-icon">üéØ</span>
        <p>–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!<br>–î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –≤ –±–æ—Ç–µ.</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
        const params = new URLSearchParams(window.location.search);
        const dataStr = params.get('data');
        let tasks = [];

        if (dataStr) {
            try {
                tasks = JSON.parse(decodeURIComponent(dataStr));
            } catch (e) {
                console.error("Data error");
            }
        }

        // 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç—ã
        const dateOptions = { weekday: 'long', day: 'numeric', month: 'long' };
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('ru-RU', dateOptions);
        document.getElementById('user-name').innerText = tg.initDataUnsafe.user?.first_name ? `–ü–ª–∞–Ω, ${tg.initDataUnsafe.user.first_name}` : "–ú–æ–π –ø–ª–∞–Ω";

        // 3. –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞
        const listContainer = document.getElementById('task-list');
        
        if (tasks.length === 0) {
            document.getElementById('empty').style.display = 'block';
        } else {
            listContainer.innerHTML = tasks.map((t, index) => {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–∫–æ–Ω–∫—É (–ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª)
                const icon = t.title.substring(0, 2).trim();
                const title = t.title.substring(2).trim();
                
                return `
                    <div class="task-card" id="task-${t.id}" style="animation-delay: ${index * 0.1}s">
                        <div class="category-icon">${icon || 'üìù'}</div>
                        <div class="task-info">
                            <h3>${title}</h3>
                            <span>‚è∞ ${t.time}</span>
                        </div>
                        <div class="check-btn" onclick="markDone(${t.id})">‚úì</div>
                    </div>
                `;
            }).join('');
        }

        // 4. –õ–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        function markDone(id) {
            tg.HapticFeedback.notificationOccurred('success');
            const btn = document.querySelector(`#task-${id} .check-btn`);
            btn.classList.add('active');
            
            const card = document.getElementById(`task-${id}`);
            card.style.opacity = '0.5';
            card.style.transform = 'scale(0.95)';

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            setTimeout(() => {
                tg.sendData(JSON.stringify({action: "done", task_id: id}));
            }, 600);
        }
    </script>
</body>
</html>
