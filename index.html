<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #000; --card: #1c1c1e; --blue: #0a84ff; --text: #fff; --grey: #8e8e93; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        .header h1 { font-size: 28px; margin: 0; }
        .header p { color: var(--grey); margin: 5px 0 25px; }
        
        .task-card {
            background: var(--card); border-radius: 12px; padding: 16px; 
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; transition: all 0.3s;
        }
        .task-info h3 { margin: 0; font-size: 17px; }
        .task-info span { color: var(--grey); font-size: 13px; }
        
        .check-btn {
            width: 26px; height: 26px; border: 2px solid #3a3a3c; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: transparent; font-size: 14px;
        }
        .check-btn.active { background: var(--blue); border-color: var(--blue); color: #fff; }
        
        #empty { text-align: center; color: var(--grey); margin-top: 60px; display: none; }
    </style>
</head>
<body>
    <div class="header">
        <h1 id="user-name">–ó–∞–¥–∞—á–∏</h1>
        <p id="date"></p>
    </div>

    <div id="list"></div>
    <div id="empty">–í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã! üéâ</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = '#000000';

        // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
        const params = new URLSearchParams(window.location.search);
        const dataStr = params.get('data');
        let tasks = [];
        
        if (dataStr) {
            try { tasks = JSON.parse(decodeURIComponent(dataStr)); } catch(e) {}
        }

        // –†–µ–Ω–¥–µ—Ä
        const listDiv = document.getElementById('list');
        if (tasks.length === 0) {
            document.getElementById('empty').style.display = 'block';
        } else {
            listDiv.innerHTML = tasks.map(t => `
                <div class="task-card" id="card-${t.id}">
                    <div class="task-info">
                        <h3>${t.title}</h3>
                        <span>‚è∞ ${t.time}</span>
                    </div>
                    <div class="check-btn" onclick="complete(${t.id})">‚úì</div>
                </div>
            `).join('');
        }

        document.getElementById('date').innerText = new Date().toLocaleDateString('ru-RU', {day:'numeric', month:'long', weekday:'short'});

        function complete(id) {
            const btn = document.querySelector(`#card-${id} .check-btn`);
            btn.classList.add('active');
            tg.HapticFeedback.notificationOccurred('success');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ —á–µ—Ä–µ–∑ 500–º—Å
            setTimeout(() => {
                tg.sendData(JSON.stringify({action: "done", task_id: id}));
            }, 500);
        }
    </script>
</body>
</html>
